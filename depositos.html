<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Depósitos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 0;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .deposit-box {
            min-width: 60px;
            max-width: 80px;
            margin: 5px;
            padding: 10px;
            background-color: #444;
            border: 1px solid #fff;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s;
        }
        .marked {
            background-color: #008000; /* Verde */
        }
        .removed {
            background-color: #dc3545; /* Vermelho */
        }
        .deposit-box:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            color: #000;
            padding: 5px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
        }
        .total-info {
            margin: 20px;
        }
        #progressContainer {
            position: relative;
            top: 0;
            right: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            height: 30px;
        }
        #progress {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #d4edda);
            width: 0;
            transition: width 0.4s ease;
            border-radius: 10px;
        }
        .feedback {
            margin-top: 20px;
            background: #444;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        .modal {
            background: #fff;
            color: #000;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            width: 300px;
        }
        .modal button {
            margin: 5px;
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        .confirm {
            background-color: #28a745;
            color: #fff;
        }
        .cancel {
            background-color: #dc3545;
            color: #fff;
        }
        .message {
            margin-top: 20px;
            font-size: 14px;
            text-align: center;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        #depositContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Controle de Depósitos</h1>
    <div id="progressContainer">
        <div id="progress"></div>
    </div>

    <p id="daysSinceStart">0 dias desde o início</p>

    <div class="total-info">
        <p>Total Depositado: R$ <span id="totalDeposited">0.00</span></p>
        <p>Faltam para completar os depósitos: R$ <span id="amountRemaining">5050.00</span></p>
        <button id="resetButton">Reiniciar Depósitos</button>
        <button id="logoutButton" style="background-color: red;">Sair</button>
    </div>

    <div class="feedback" id="feedbackMessage"></div>
    <div id="depositContainer"></div>

    <!-- Modal -->
    <div id="modalContainer" class="modal-overlay" style="display: none;">
        <div class="modal">
            <p id="modalMessage"></p>
            <button id="modalConfirm" class="confirm">Confirmar</button>
            <button id="modalCancel" class="cancel">Cancelar</button>
        </div>
    </div>

    <script>
        const totalAmount = 5050.00;
        const deposits = Array.from({ length: 100 }, (_, i) => i + 1);
        const markedDeposits = new Map();
        const username = localStorage.getItem('currentUser');
        const modalContainer = document.getElementById('modalContainer');
        const modalMessage = document.getElementById('modalMessage');
        const modalConfirm = document.getElementById('modalConfirm');
        const modalCancel = document.getElementById('modalCancel');
        let modalCallback = null;

        function init() {
            const savedDeposits = JSON.parse(localStorage.getItem(`${username}_markedDeposits`)) || [];
            savedDeposits.forEach(([deposit, date]) => markedDeposits.set(Number(deposit), date));
            updateDaysSinceStart();
            updateTotals();
            deposits.forEach(createDepositBox);
            updateProgressBar();
        }

        function createDepositBox(deposit) {
            const container = document.getElementById('depositContainer');
            const box = document.createElement('div');
            box.className = 'deposit-box';
            box.textContent = deposit;
            box.dataset.tooltip = '';

            if (markedDeposits.has(deposit)) {
                box.classList.add('marked');
            }

            box.onclick = () => handleDepositToggle(deposit, box);
            container.appendChild(box);
        }

        function handleDepositToggle(deposit, box) {
            if (box.classList.contains('removed')) {
                showModal(`Deseja depositar novamente o valor ${deposit}?`, () => {
                    markedDeposits.set(deposit, new Date().toISOString());
                    box.classList.remove('removed');
                    box.classList.add('marked');
                    box.dataset.tooltip = '';
                    saveData();
                    updateTotals();
                    updateProgressBar();
                });
            } else if (box.classList.contains('marked')) {
                showModal(`Tem certeza que deseja retirar o depósito ${deposit}?`, () => {
                    markedDeposits.delete(deposit);
                    box.classList.remove('marked');
                    box.classList.add('removed');
                    box.dataset.tooltip = 'Depósito retirado';
                    saveData();
                    updateTotals();
                    updateProgressBar();
                });
            } else {
                markedDeposits.set(deposit, new Date().toISOString());
                box.classList.add('marked');
                box.classList.remove('removed');
                box.dataset.tooltip = '';
                saveData();
                updateTotals();
                updateProgressBar();
            }
        }

        function updateDaysSinceStart() {
            if (!markedDeposits.size) return;
            const firstDate = new Date([...markedDeposits.values()][0]);
            const days = Math.floor((new Date() - firstDate) / (1000 * 3600 * 24));
            document.getElementById('daysSinceStart').textContent = `${days} dias desde o início`;
        }

        function updateTotals() {
            const total = [...markedDeposits.keys()].reduce((acc, val) => acc + val, 0);
            document.getElementById('totalDeposited').textContent = total.toFixed(2);
            document.getElementById('amountRemaining').textContent = (totalAmount - total).toFixed(2);
        }

        function updateProgressBar() {
            const total = [...markedDeposits.keys()].reduce((acc, val) => acc + val, 0);
            const progress = (total / totalAmount) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }

        function saveData() {
            localStorage.setItem(`${username}_markedDeposits`, JSON.stringify([...markedDeposits]));
        }

        function showModal(message, callback) {
            modalMessage.textContent = message;
            modalContainer.style.display = 'flex';
            modalCallback = callback;
        }

        modalConfirm.onclick = () => {
            modalContainer.style.display = 'none';
            if (modalCallback) modalCallback();
        };

        modalCancel.onclick = () => {
            modalContainer.style.display = 'none';
        };

        document.getElementById('resetButton').onclick = function () {
            showModal('Tem certeza que deseja reiniciar todos os depósitos?', () => {
                markedDeposits.clear();
                saveData();
                updateTotals();
                updateProgressBar();
                resetDepositBoxes();
            });
        };

        function resetDepositBoxes() {
            const depositBoxes = document.querySelectorAll('.deposit-box');
            depositBoxes.forEach(box => {
                box.classList.remove('marked', 'removed');
                box.dataset.tooltip = '';
            });
        }

        document.getElementById('logoutButton').onclick = function () {
            window.location.href = 'login.html';
        };

        init();
    </script>
</body>
</html>
